PrintWriter out= new PrintWriter(new BufferedWriter(new FileWriter("foo.out")));
while ( read message as you doing now)  {
    // do something 
    out.println(message);
    // do something
}